{
  "name": "Test-driven-react-native-android-application",
  "tagline": "",
  "body": "# Test driving react native applications\r\n\r\nReact Native is a game changing mobile app development framework that concentrates on fast development. Based on the philosophy \"Learn once, write anywhere\", it makes it possible to build IOS, Android and Windows mobile apps just using Javascript.\r\n\r\nSo React Native helps you to build awesome applications across multiple platforms. Now you have one question lingering in your head and that is the reason you are reading this post. How am I going to test these ? We also had the same question while working on React Native and couldn't find a hands-on tutorial that helps a beginner get started on writing tests for React Native applications. Read on this post and once you finish it, you will feel much more confident in testing React Native applications.\r\n\r\nThis tutorial assumes you are comfortable working with React Native, basic concepts of React, and testing of Javascript code. If not, feel free to checkout the following links.\r\n\r\n\r\n\r\nAfter completing this tutorial you will be able to\r\n\r\n* Write unit tests for your component logic.\r\n* Test behaviour of components on various user interactions like press and scroll.\r\n* Easily test defaultProps, propTypes, state transitions and similar aspects of React components. \r\n* Appreciate how TDD encourages you to follow idioms in react.\r\n\r\n\r\n\r\nBefore we actually jump into the code, let us take a brief walkthrough over our test setup. We will be using the following libraries for testing.\r\n\r\n* [Babel][1]: A Javascript compiler to transpile our javascript code so that it is compatible everywhere.\r\n* [Mocha][2]: A Javascript testing framework running on [node.js][3] to run our tests.\r\n* [Chai][4] : A library that provides us with interfaces to write assertions in our test.\r\n* [Sinon][5]: A library that provides us with spies, stubs and mocks which are used extensively while testing.\r\n* [React Native Mock][6] : Library that provides a completely mocked version of react-native that is easily testable.\r\n* [Enzyme][7]: A React test utility that helps us to write painless tests for react components.JavaScript Testing utility for React that makes it easier to assert, manipulate, and traverse your React Components.\r\n\r\nSetting all these up is a pain, but we have done that for you. Checkout our [react native boiler plate][8] that helps you kickstart your application development with all the setup done for state model, testing, continuous integration etc. Go to your console and type the following commands.\r\n\r\n    git clone https://github.com/multunus/react-native-boilerplate ReactNativeBoilerplate\r\n    cd ReactNativeBoilerplate\r\n    npm install\r\n\r\nRename `config.example.json` to `config.json` and modify it as required.\r\n\r\nThe app is setup to use the [NodeJS JWT Authentication sample server][9], follow the instructions and update the baseURL in`config.json` to a valid url say `http://localhost`.\r\n\r\nThat's it. Time for coding!\r\n\r\nIt's time to rewind back a little bit and refresh the first tutorial you ever did on [React][10]. The simple Comment Box. If you haven't gone through it, you can take a look at it [here][11]. We will build the same application in React Native using [TDD][12]. We will be replacing the react components used in the tutorial by native components for android and using [Async Storage][13] provided by react native to store our data instead of a server with a database. If you are not comfortable with Test Driven Development, you may choose to write your code and then write tests for it. But we feel TDD improves the quality of your code and especially while working on React, this is more evident as the components you build will be simple, testable and you will refrain yourselves from writing too much of logic into your components.\r\n\r\nWe are going to build the app in Android platform. But don't worry if you are using react native for IOS or Windows mobile app development, the testing techniques you learn here is independent of the platform and can be applied across platforms.  \r\nWe shall use the same component structure as in the react tutorial for our app.\r\n\r\n* A view of all of the comments\r\n* A form to submit a comment\r\n\r\nWe will have the following component hierarchy\r\n\r\n-`CommentBox`: The root component  \r\n -`CommentList` : To display a list of all components  \r\n   -`Comment` : To display a single comment  \r\n -`CommentForm` : A form for user to write a comment\r\n\r\n**Our first test**\r\n\r\nOkay, now it's time for coding. Let us write our first test. The components for the app are written in `src/components` directory and the corresponding tests for components are written in `src/components/__specs__` directory. Open a new file `src/components/__specs__/Comment.spec.js` and write the following code.\r\n\r\n```js\r\nimport React, { View } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport Comment from '../Comment.js';\r\n\r\ndescribe('<comment>', () => {\r\n  it('should be a view component', () => {\r\n  const wrapper = shallow(<comment></comment>);\r\n  \r\n    expect(wrapper.type()).to.equal(View);\r\n  });\r\n});\r\n```\r\n\r\nThat is a simple test to begin with. Let's checkout what is going on here. We are using [shallow rendering API][14] of enzyme here. It is useful to constrain yourself to testing a component as a unit, and to ensure that your tests aren't indirectly asserting on behaviour of child components. `shallow()` method returns a shallow wrapper object around the component that is to be tested. Enzyme provides a rich set of methods that can be called on the wrapper instance, for testing various aspects of a component. Check out the [docs][14] . In this spec we are just checking the type of the component.\r\n\r\nWe must appreciate the work of Leland Richardson for building [Enzyme][15] ( JS testing utility which helps us write tests for react \"web\" components) and [React Native Mock][6] ( fully mocked and test-friendly version of react native, which makes enzyme compatible with react native). The result of this effort is painless testing of react native components.\r\n\r\nNow save the file and run `npm test` from console and watch your tests fail. Now we build the `Comment` component. Open `src/components/Comment.js` and write the following code.\r\n\r\n```js\r\nimport React, {Component, View } from 'react-native';\r\n\r\nexport default class Comment extends React.Component {\r\n  render() {\r\n  return(\r\n  <view>\r\n  </view>\r\n  );\r\n  }\r\n}\r\n```\r\n\r\nNow run `npm test` from console and see your tests pass. Bingo! Now we will be progressively writing tests and code to build the complete app. We'll be following the same procedure for the rest of our tutorial. Write tests, watch it fail, write code, see it passing, refactor if necessary. You can read more about [Red Green Refactor here][16] .  \r\nNow that we're all good to go, let's start with the topmost component in the component structure.\r\n\r\n`src/components/__specs__/CommentBox.spec.js`\r\n\r\n```js\r\nimport React, { View, Text } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentBox from '../CommentBox.js';\r\n\r\ndescribe('<commentbox>', () => {\r\n  beforeEach(function() {\r\n  wrapper = shallow(<commentbox>);\r\n  });\r\n\r\n  it('should be a view component', () => {\r\n  expect(wrapper.type()).to.equal(View);\r\n  });\r\n\r\n  it('should have a title Comment It', () => {\r\n  expect(wrapper.contains(<text>Comment It</text>)).to.equal(true);\r\n  });\r\n});\r\n```\r\n\r\nThese tests describe CommentBox to be a View component and have a Text component inside it. We'll write minimal amount of code to make this test pass. and a Text component with the text \"Comment It\" in it. Now the actual code.\r\n\r\n`src/components/CommentBox.js`\r\n\r\n```js\r\nimport React, {Component, Text, View } from 'react-native';\r\n\r\nexport default class CommentBox extends React.Component {\r\n  render() {\r\n  return(\r\n  <view>\r\n  <text>Comment It</text>\r\n  </view>\r\n  );\r\n  }\r\n}\r\n```\r\n\r\nWe need a CommentList and CommentForm component inside our CommentBox.  \r\nWe'll just define these components without working logic just for now, and come back to these components and complete them later.\r\n\r\n`src/components/__specs__/CommentForm.spec.js`\r\n\r\n```js\r\nimport React, { View } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentForm from '../CommentForm.js';\r\n\r\ndescribe('<commentform>', () => { \r\n  it('should be a view component', () => {\r\n  wrapper = shallow(<commentform>);\r\n  \r\n    expect(wrapper.type()).to.equal(View);\r\n  }); \r\n});\r\n```\r\n\r\n`src/components/CommentForm.js`\r\n\r\n```js\r\nimport React, {Component, View } from 'react-native';\r\n\r\nexport default class CommentForm extends React.Component {\r\n  render() {\r\n  return(\r\n  <view>\r\n  </view>\r\n  );\r\n  }\r\n}\r\n```\r\n\r\n`src/components/__specs__/CommentList.spec.js`\r\n```js\r\nimport React, { ListView } from 'react-native';\r\n\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentList from '../CommentList.js';\r\n\r\ndescribe('<commentlist>', () => {\r\n  it('should be a ListView component', () => {\r\n  const wrapper = shallow(<commentlist>);\r\n  \r\n    expect(wrapper.type()).to.equal(ListView);\r\n  });\r\n});\r\n```\r\n\r\n`src/components/CommentList.js`\r\n```js\r\nimport React, {Component, ListView} from 'react-native';\r\n\r\nexport default class CommentList extends React.Component {\r\n  render() {\r\n  return(\r\n  <listview>\r\n  );\r\n  }\r\n}\r\n```\r\n\r\nLet's add them to CommentBox component. Add a couple of specs to CommentBox.spec.js as follows  \r\n\r\n`src/components/__specs__/CommentBox.spec.js`\r\n```js\r\nimport React, { View, Text } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentBox from '../CommentBox.js';\r\nimport CommentList from '../CommentList.js';\r\nimport CommentForm from '../CommentForm.js';\r\n\r\ndescribe('<commentbox>', () => {\r\n  beforeEach(function() {\r\n  wrapper = shallow(<commentbox>);\r\n  });\r\n  \r\n  it('should be a view component', () => {\r\n  expect(wrapper.type()).to.equal(View);\r\n  });\r\n\r\n  it('should have a title Comment It', () => {\r\n  expect(wrapper.contains(<text>Comment It</text>)).to.equal(true);\r\n  });\r\n\r\n  it('should render CommentList component', () => {\r\n  expect(wrapper.find(CommentList)).to.have.length(1);\r\n  });\r\n\r\n  it('should render CommentForm component', () => {\r\n  expect(wrapper.find(CommentForm)).to.have.length(1);\r\n  });\r\n});\r\n```\r\n\r\n`src/components/CommentBox.js`\r\n```js\r\nimport React, {Component,Text, View} from 'react-native';\r\n\r\nimport CommentList from './CommentList.js';\r\nimport CommentForm from './CommentForm.js';\r\n\r\nexport default class CommentBox extends React.Component {\r\n  render() {\r\n  return(\r\n  <view>\r\n  <text>Comment It</text>\r\n  <commentlist>\r\n  <commentform>\r\n  </commentform></commentlist></view>\r\n  );\r\n  }\r\n}\r\n```\r\nNow that we have the whole structure in place, we'll implement with the functionality starting with Comment component.\r\n\r\nFor each comment we'll pass author name of the comment and the actual comment as props. Comment component should take these props and render both the author name and actual comment.\r\n\r\n`src/components/__specs__/Comment.spec.js`\r\n```js\r\nimport React, { View, Text } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport Comment from '../Comment.js';\r\n\r\ndescribe('<comment>', () => {\r\n  it('should be a view component', () => {\r\n  const wrapper = shallow(<comment></comment>);\r\n  \r\n    expect(wrapper.type()).to.equal(View);\r\n  });\r\n\r\n  it('should render 2 text components', () => {\r\n  const wrapper = shallow(<comment>);\r\n  \r\n    expect(wrapper.find(Text)).to.have.length(2);\r\n  });\r\n\r\n  it('should render the given comment', () => {\r\n  const wrapper = shallow(<comment> This is a comment </comment>);\r\n\r\n  expect(wrapper.contains(<text> This is a comment </text>)).to.equal(true);\r\n  });\r\n\r\n  it('should render the given author name', () => {\r\n  const wrapper = shallow(<comment author=\"Author\"></comment>);\r\n  \r\n    expect(wrapper.contains(<text>Author</text>)).to.equal(true);\r\n  });\r\n});\r\n```\r\n\r\n`src/components/Comment.js`\r\n```js\r\nimport React, {Component, View, Text} from 'react-native';\r\n\r\nexport default class Comment extends React.Component {\r\n  render() {\r\n  return(\r\n  <view>\r\n  <text>\r\n  {this.props.author}\r\n  </text>\r\n  <text>\r\n  {this.props.children}\r\n  </text>\r\n  </view>\r\n  );\r\n  }\r\n}\r\n```\r\nAha! We have successfully test-driven our first React Native component.\r\n\r\n\r\n\r\nSince we have comments now, let's list them out in our CommentList component. The CommentList component takes all the comment data as an array of JSONs and render each comment.  \r\nFeel free to refer docsif you have any questions on usage of [ListView][17].\r\n\r\n`src/components/__specs__/CommentList.spec.js`\r\n```js\r\nimport React, { View, ListView } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentList from '../CommentList.js';\r\nimport Comment from '../Comment.js';\r\n\r\ndescribe('<commentlist>', () => {\r\nbeforeEach(function() {\r\ndata = [\r\n{ author: \"Pete Hunt\", text: \"This is one comment\"},\r\n{ author: \"Jordan Walke\", text: \"This is a super comment\"},\r\n{ author: \"Jordan Walkerr\", text: \"This is an ordinary comment\"}\r\n];\r\n});\r\n\r\nit('should define its propTypes', () => {\r\nexpect(CommentList.propTypes.data).to.be.an('function');\r\n});\r\n\r\nit('should be a ListView component', () => {\r\nconst wrapper = shallow(<commentlist data=\"{data}\">);\r\n\r\n    expect(wrapper.type()).to.equal(ListView);\r\n});\r\n\r\nit('should have correct datasource in state', () => {\r\nconst wrapper = shallow(<commentlist data=\"{data}\">);\r\n\r\n    expect(wrapper.state('dataSource')._dataBlob).to.equal(data);\r\n});\r\n});\r\n```\r\n\r\n`src/components/CommentList.js`\r\n```js\r\nimport React, {Component, View, ListView} from 'react-native';\r\nimport Comment from './Comment.js';\r\n\r\nexport default class CommentList extends React.Component {\r\n  static propTypes = {\r\n    data: React.PropTypes.array\r\n  };\r\n  \r\n  constructor(props) {\r\n  super(props);\r\n  this.state = {\r\n  dataSource: new ListView.DataSource({rowHasChanged: (r1, r2) => r1 !== r2}).cloneWithRows(this.props.data)\r\n  };\r\n  }\r\n  \r\n  componentWillReceiveProps(){\r\n  this.setState({\r\n  dataSource: this.state.dataSource.cloneWithRows(this.props.data)\r\n  });\r\n  }\r\n  \r\n  render() {\r\n  return (\r\n  <listview          datasource=\"{this.state.dataSource}\"          renderrow=\"{this.renderComment.bind(this)}\"        =\"\">\r\n  );\r\n  }\r\n  renderComment(row) {\r\n  return (\r\n  <comment author=\"{row.author}\">{row.text}</comment>\r\n  );\r\n  }\r\n}\r\n```\r\n\r\nEvery time the CommentList component gets re-rendered, we need to update the dataSource state of the component to display newly added comment to the CommentList. We are just doing that in `componentWillReceiveProps` method.\r\n\r\nNote that we wrote a spec to ensure that the propTypes of the component is defined. Read more about propTypes [here][18] .\r\n\r\nWe can list comments but cannot add a new one. For that let us build the CommentForm component. It has two text input fields to input author name and actual comment and a submit button to submit the comment. Let's build the basic UI of this component and then build the functionality.\r\n\r\n`src/components/__specs__/CommentForm.spec.js`\r\n```js\r\nimport React, { View, TouchableNativeFeedback, TextInput, Text } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentForm from '../CommentForm.js';\r\n\r\ndescribe('<commentform>', () => {\r\n  beforeEach(function() {\r\n      wrapper = shallow(<commentform>);\r\n  });\r\n\r\n  it('should be a view component', () => {\r\n    expect(wrapper.type()).to.equal(View);\r\n  });\r\n\r\n  it('should have 2 TextInput components', () => {\r\n    expect(wrapper.find(TextInput)).to.have.length(2);\r\n  });\r\n\r\n  it('should have a submit button', () => {\r\n    expect(wrapper.find(TouchableNativeFeedback)).to.have.length(1);\r\n    expect(wrapper.find(TouchableNativeFeedback).containsMatchingElement(<text>Submit</text>)).to.equal(true);\r\n  });\r\n});\r\n```\r\n\r\n`src/components/CommentForm.js`\r\n```js\r\nimport React, {Component, View, TouchableNativeFeedback, Text, TextInput} from 'react-native';\r\n\r\nexport default class CommentForm extends React.Component {\r\n  render() {\r\n    return(\r\n        <view>\r\n          <textinput placeholder=\"name\" style=\"{{height:\" 40,=\"\" bordercolor:=\"\" 'gray',=\"\" borderwidth:=\"\" 1}}=\"\">\r\n          <textinput placeholder=\"comment\" style=\"{{height:\" 40,=\"\" bordercolor:=\"\" 'gray',=\"\" borderwidth:=\"\" 1}}=\"\">\r\n        <touchablenativefeedback>\r\n            <view style=\"{{width:\" 150,=\"\" height:=\"\" 100,=\"\" backgroundcolor:=\"\" 'red'}}=\"\">\r\n              <text style=\"{{margin:\" 30}}=\"\">Submit</text>\r\n            </view>\r\n        </touchablenativefeedback>\r\n        </textinput></textinput></view>\r\n    );\r\n  }\r\n}\r\n```\r\nThe functionality of the CommentForm component is as follows.\r\n\r\n* The input value of two TextInput components for entering author and comment should depend on state of the CommentForm component.\r\n* When user enters text and the text in the input field changes, update the state to corresponding value\r\n* On clicking the submit button, it should invoke `handleCommentSubmit` method of CommentBox component, which is passed as props to the CommentForm component and it should also set the author and comment state to initial blank string.\r\n\r\nFor time- being let us define an empty method in CommentBox component.\r\n\r\n`src/components/CommentBox.js`\r\n```js\r\nimport React, {Component,Text, View} from 'react-native';\r\n\r\nimport CommentList from './CommentList.js';\r\nimport CommentForm from './CommentForm.js';\r\n\r\nexport default class CommentBox extends React.Component {\r\n\r\n  handleCommentSubmit(comment_data) {\r\n  }\r\n\r\n  render() {\r\n    return(\r\n        <view>\r\n          <text>Comment It</text>\r\n          <commentlist>\r\n          <commentform>\r\n        </commentform></commentlist></view>\r\n    );\r\n  }\r\n}\r\n```\r\n\r\nNow lets make sure that state of the CommentForm component changes with data in the input fields and the value of the input components are dependent on state.\r\n\r\n`src/components/__specs__/CommentForm.spec.js`\r\n```js\r\nimport React, { View, TouchableNativeFeedback, TextInput, Text} from 'react-native';\r\n\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentForm from '../CommentForm.js';\r\n\r\ndescribe('<commentform>', () => {\r\n  beforeEach(function() {\r\n    wrapper = shallow(<commentform>);\r\n  });\r\n\r\n  it('should be a view component', () => {\r\n    expect(wrapper.type()).to.equal(View);\r\n  });\r\n\r\n  it('should have an initial state', () => {\r\n    expect(wrapper.state('name')).to.equal(\"\");\r\n    expect(wrapper.state('comment')).to.equal(\"\");\r\n  });\r\n\r\n  it('should have 2 TextInput components', () => {\r\n    expect(wrapper.find(TextInput)).to.have.length(2);\r\n  });\r\n\r\n  it('should have a submit button', () => {\r\n    expect(wrapper.find(TouchableNativeFeedback)).to.have.length(1);\r\n    expect(wrapper.find(TouchableNativeFeedback).containsMatchingElement(<text>Submit</text>)).to.equal(true);\r\n  });\r\n\r\n  it('should have author input component with value dependent on state', () => {\r\n    wrapper.setState({name: 'JK'});\r\n\r\n    expect(wrapper.find(TextInput).first().props().value).to.equal('JK');\r\n  });\r\n\r\n  it('should have the comment input component with value dependent on state', () => {\r\n    wrapper.setState({comment: 'An awesome comment'});\r\n\r\n    expect(wrapper.find(TextInput).at(1).props().value).to.equal('An awesome comment');\r\n  });\r\n\r\n  it('should change state when the text of author input component changes', () => {\r\n    const authorInputComponent = wrapper.find('TextInput').first();\r\n\r\n    authorInputComponent.simulate('ChangeText','wenger');\r\n    expect(wrapper.state('name')).to.equal('wenger');\r\n  });\r\n\r\n  it('should change state when the text of comment input component changes', () => {\r\n    const commentInputComponent = wrapper.find('TextInput').at(1);\r\n\r\n    commentInputComponent.simulate('ChangeText','arsenal');\r\n\r\n    expect(wrapper.state('comment')).to.equal('arsenal');\r\n  });\r\n});\r\n```\r\n\r\n` ``src/components/CommentForm.js`\r\n```js\r\nimport React, {Component, View, TouchableNativeFeedback, Text, TextInput} from 'react-native';\r\n\r\nexport default class CommentForm extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {name: '', comment: ''};\r\n  }\r\n\r\n  render() {\r\n    return(\r\n        <view>\r\n          <textinput placeholder=\"name\" style=\"{{height:\" 40,=\"\" bordercolor:=\"\" 'gray',=\"\" borderwidth:=\"\" 1}}=\"\" onchangetext=\"{(text)\" ==\"\"> this.setState({name: text})}\r\n            value={this.state.name}\r\n          />\r\n          <textinput placeholder=\"comment\" style=\"{{height:\" 40,=\"\" bordercolor:=\"\" 'gray',=\"\" borderwidth:=\"\" 1}}=\"\" onchangetext=\"{(content)\" ==\"\"> this.setState({comment: content})}\r\n            value={this.state.comment}\r\n          />\r\n          <touchablenativefeedback>\r\n            <view style=\"{{width:\" 150,=\"\" height:=\"\" 100,=\"\" backgroundcolor:=\"\" 'red'}}=\"\">\r\n              <text style=\"{{margin:\" 30}}=\"\">Submit</text>\r\n            </view>\r\n          </touchablenativefeedback>\r\n        </textinput></textinput></view>\r\n    );\r\n  }\r\n}\r\n```\r\n\r\nNow that that's done we'll wire up submission of form on clicking submit button. We must ensure that the submit button click should restore the state of two input components to initial state.\r\n\r\n`src/components/__specs__/CommentForm.spec.js`\r\n```js\r\nimport React, { View, TouchableNativeFeedback, TextInput, Text} from 'react-native';\r\n\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\nimport sinon from 'sinon';\r\n\r\nimport CommentForm from '../CommentForm.js';\r\nimport CommentBox from '../CommentBox.js';\r\n\r\ndescribe('<commentform>', () => {\r\n  beforeEach(function() {\r\n    wrapper = shallow(<commentform>);\r\n  });\r\n\r\n  it('should be a view component', () => {\r\n    expect(wrapper.type()).to.equal(View);\r\n  });\r\n\r\n  it('should have an initial state', () => {\r\n    expect(wrapper.state('name')).to.equal(\"\");\r\n    expect(wrapper.state('comment')).to.equal(\"\");\r\n  });\r\n\r\n  it('should have 2 TextInput components', () => {\r\n    expect(wrapper.find(TextInput)).to.have.length(2);\r\n  });\r\n\r\n  it('should have a submit button', () => {\r\n    expect(wrapper.find(TouchableNativeFeedback)).to.have.length(1);\r\n    expect(wrapper.find(TouchableNativeFeedback).containsMatchingElement(<text>Submit</text>)).to.equal(true);\r\n  });\r\n\r\n  it('should have author input component with value dependent on state', () => {\r\n    wrapper.setState({name: 'JK'});\r\n    expect(wrapper.find(TextInput).first().props().value).to.equal('JK');\r\n  });\r\n\r\n  it('should have the comment input component with value dependent on state', () => {\r\n    wrapper.setState({comment: 'An awesome comment'});\r\n    expect(wrapper.find(TextInput).at(1).props().value).to.equal('An awesome comment');\r\n  });\r\n\r\n  it('should change state when the text of author input component changes', () => {\r\n    const authorInputComponent = wrapper.find('TextInput').first();\r\n\r\n    authorInputComponent.simulate('ChangeText','wenger');\r\n\r\n    expect(wrapper.state('name')).to.equal('wenger');\r\n  });\r\n\r\n  it('should change state when the text of comment input component changes', () => {\r\n    const commentInputComponent = wrapper.find('TextInput').at(1);\r\n\r\n    commentInputComponent.simulate('ChangeText','arsenal');\r\n\r\n    expect(wrapper.state('comment')).to.equal('arsenal');\r\n  });\r\n\r\n  it('invokes handleCommitSubmit method of CommentBox with author and comment', () => {\r\n    sinon.stub(CommentBox.prototype, \"handleCommentSubmit\");\r\n\r\n    const wrapper = shallow(<commentform oncommentsubmit=\"{CommentBox.prototype.handleCommentSubmit}/\">);\r\n    const submitButton = wrapper.find('TouchableNativeFeedback').first();\r\n    wrapper.setState({name: 'JK '});\r\n    wrapper.setState({comment: ' Arsenal is the best'});\r\n\r\n    submitButton.simulate('press');\r\n\r\n    expect(CommentBox.prototype.handleCommentSubmit.calledWith({author: 'JK', text: 'Arsenal is the best'})).to.be.true;\r\n    CommentBox.prototype.handleCommentSubmit.restore();\r\n  });\r\n\r\n  it('sets the state of two input fields to the initial state on press', () => {\r\n    sinon.stub(CommentBox.prototype, \"handleCommentSubmit\");\r\n\r\n    const wrapper = shallow(<commentform oncommentsubmit=\"{CommentBox.prototype.handleCommentSubmit}/\">);\r\n    const submitButton = wrapper.find('TouchableNativeFeedback').first();\r\n    wrapper.setState({name: 'JK'});\r\n    wrapper.setState({comment: 'Arsenal is the best'});\r\n\r\n    submitButton.simulate('press');\r\n\r\n    expect(wrapper.state('name')).to.equal(\"\");\r\n    expect(wrapper.state('comment')).to.equal(\"\");\r\n\r\n    CommentBox.prototype.handleCommentSubmit.restore();\r\n  });\r\n});\r\n```\r\n\r\n`src/components/CommentForm.js`\r\n```js\r\nimport React, {Component, View, TouchableNativeFeedback, Text, TextInput} from 'react-native';\r\n\r\nexport default class CommentForm extends React.Component {\r\n\r\n  constructor(props) {\r\n  super(props);\r\n  this.state = {name: '', comment: ''};\r\n  }\r\n  static propTypes = {\r\n  onCommentSubmit: React.PropTypes.func\r\n  };\r\n\r\n  render() {\r\n  return(\r\n  <view>\r\n    <textinput placeholder=\"name\" style=\"{{height:\" 40,=\"\" bordercolor:=\"\" 'gray',=\"\" borderwidth:=\"\" 1}}=\"\" onchangetext=\"{(text)\" ==\"\"> this.setState({name: text})}\r\n    value={this.state.name}\r\n    />\r\n  <textinput placeholder=\"comment\" style=\"{{height:\" 40,=\"\" bordercolor:=\"\" 'gray',=\"\" borderwidth:=\"\" 1}}=\"\" onchangetext=\"{(content)\" ==\"\"> this.setState({comment: content})}\r\n    value={this.state.comment}\r\n  />\r\n  <touchablenativefeedback onpress=\"{()\" ==\"\"> this.onPressButton()}>\r\n    <view style=\"{{width:\" 150,=\"\" height:=\"\" 100,=\"\" backgroundcolor:=\"\" 'red'}}=\"\">\r\n    <text style=\"{{margin:\" 30}}=\"\">Submit</text>\r\n    </view>\r\n  </touchablenativefeedback>\r\n  </textinput></textinput></view>\r\n  );\r\n  }\r\n\r\n  onPressButton() {\r\n  var author = this.state.name.trim();\r\n  var comment = this.state.comment.trim();\r\n  this.state = {name: '', comment: ''};\r\n  this.props.onCommentSubmit({author: author, text: comment});\r\n  }\r\n}\r\n```\r\nObserve how we test the behaviour of components on user interaction. We use [simulate()][19] method provided by shallow rendering API of enzyme to simulate the `press` event here. This method can be used to test other types of user interactions as well.\r\n\r\nCommentBox component is where everything is wired up together. It should pass a list of comment data to CommentList as props and also handle storing the comments when submitted from CommentForm.  \r\nWe'll use [Asyncstorage][13] of React-Native to store and retrieve comments. We'll start with getting the comments and passing them to CommentList. The key for AsyncStorage data collection will be passed as props to CommentBox from app's root component. Let us take care of submitting of a comment first .\r\n\r\n`src/components/__specs__/CommentBox.spec.js`\r\n```js\r\nimport React, { View, Text, AsyncStorage } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\nimport sinon from 'sinon';\r\n\r\nimport CommentBox from '../CommentBox.js';\r\nimport CommentList from '../CommentList.js';\r\nimport CommentForm from '../CommentForm.js';\r\n\r\ndescribe('<commentbox>', () => {\r\n\r\n  beforeEach(function() {\r\n    wrapper = shallow(<commentbox asyncstoragekey=\"{'comments'}\">);\r\n  });\r\n\r\n  it('should be a view component', () => {\r\n    expect(wrapper.type()).to.equal(View);\r\n  });\r\n\r\n  it('should have a title Comment It', () => {\r\n    expect(wrapper.contains(<text>Comment It</text>)).to.equal(true);\r\n  });\r\n\r\n  it('should render comment list component', () => {\r\n    expect(wrapper.find(CommentList)).to.have.length(1);\r\n  });\r\n\r\n  it('should render comment form component', () => {\r\n    expect(wrapper.find(CommentForm)).to.have.length(1);\r\n  });\r\n\r\n  it('should have an initial state', () => {\r\n    expect(wrapper.state('data').length).to.equal(0);\r\n  });\r\n\r\n  it('should pass its state data as props to commentlist component', () => {\r\n    expect(wrapper.find(CommentList).props().data).to.eql(wrapper.state('data'));\r\n  });\r\n\r\n  it('should pass its handleCommentSubmit method as props to CommentForm component', () => {\r\n    commentBox = new CommentBox();\r\n\r\n    var definedMethod = commentBox.handleCommentSubmit;\r\n\r\n    var passedMethod = wrapper.find(CommentForm).props().onCommentSubmit;\r\n    expect(definedMethod.toString()).to.equal(passedMethod.toString());\r\n  });\r\n\r\n  describe('handleCommentSubmit', () => {\r\n  it('stores comment data using asyncstorage on comment submit', () => {\r\n    var data = [\r\n      { author: \"Pete Hunt\", text: \"This is one comment\"},\r\n      { author: \"Jordan Walke\", text: \"This is a super comment\"},\r\n         { author: \"Jordan Walkerr\", text: \"This is an ordinary comment\"}\r\n       ];\r\n\r\n    commentBox = new CommentBox({asyncStorageKey: 'comments'});\r\n    commentBox.state.data = data;\r\n    var commentData = {author: 'JK', text: 'Arsenal is the best'};\r\n    data.push(commentData);\r\n    var spy = sinon.spy(AsyncStorage, \"setItem\");\r\n\r\n    commentBox.handleCommentSubmit(commentData);\r\n\r\n    expect(spy.calledOnce).to.be.true;\r\n    expect(spy.calledWith('comments', JSON.stringify(data))).to.be.true;\r\n  });\r\n  });\r\n});\r\n```\r\n`src/components/CommentBox.js`\r\n```js\r\nimport React, {Component, Text, View, AsyncStorage } from 'react-native';\r\nimport CommentList from './CommentList.js';\r\nimport CommentForm from './CommentForm.js';\r\n\r\nexport default class CommentBox extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {data: []};\r\n    this.handleCommentSubmit = this.handleCommentSubmit.bind(this);\r\n  }\r\n\r\n  static propTypes =  {\r\n    asyncStorageKey: React.PropTypes.string\r\n  };\r\n\r\n  handleCommentSubmit(comment_data) {\r\n    var comments = this.state.data;\r\n    comments.push(comment_data);\r\n    AsyncStorage.setItem(this.props.asyncStorageKey, JSON.stringify(comments));\r\n  }\r\n\r\n  render() {\r\n    return(\r\n        <view>\r\n          <text>Comment It</text>\r\n          <commentlist data=\"{this.state.data}/\">\r\n          <commentform oncommentsubmit=\"{this.handleCommentSubmit}/\">\r\n        </commentform></commentlist></view>\r\n    );\r\n  }\r\n}\r\n```\r\nThat takes care of submitting comment part. Now lets do the comment loading part\r\n\r\n`src/components/__specs__/CommentBox.spec.js`\r\n```js\r\nimport React, { View, Text, AsyncStorage } from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\nimport sinon from 'sinon';\r\n\r\nimport CommentBox from '../CommentBox.js';\r\nimport CommentList from '../CommentList.js';\r\nimport CommentForm from '../CommentForm.js';\r\n\r\ndescribe('<commentbox>', () => {\r\n  describe('handleCommentSubmit', () => {\r\n    it('stores comment data using asyncstorage on comment submit', () => {\r\n      var data = [\r\n      { author: \"Pete Hunt\", text: \"This is one comment\"},\r\n      { author: \"Jordan Walke\", text: \"This is a super comment\"},\r\n      { author: \"Jordan Walkerr\", text: \"This is an ordinary comment\"}\r\n    ];\r\n\r\n    commentBox = new CommentBox({asyncStorageKey: 'comments'});\r\n    commentBox.state.data = data;\r\n    var commentData = {author: 'JK', text: 'Arsenal is the best'};\r\n    data.push(commentData);\r\n    var spy = sinon.spy(AsyncStorage, \"setItem\");\r\n\r\n    commentBox.handleCommentSubmit(commentData);\r\n\r\n    expect(spy.calledOnce).to.be.true;\r\n    expect(spy.calledWith('comments', JSON.stringify(data))).to.be.true;\r\n  });\r\n\r\n  it('invokes the getComments method', () => {\r\n    var data = [\r\n      { author: \"Pete Hunt\", text: \"This is one comment\"},\r\n      { author: \"Jordan Walke\", text: \"This is a super comment\"},\r\n      { author: \"Jordan Walkerr\", text: \"This is an ordinary comment\"}\r\n    ];\r\n\r\n    commentBox = new CommentBox({asyncStorageKey: 'comments'});\r\n    sinon.stub(commentBox, \"getComments\");\r\n    var commentData = {author: 'JK', text: 'Arsenal is the best'};\r\n\r\n    commentBox.handleCommentSubmit(commentData);\r\n\r\n    expect(commentBox.getComments.calledOnce).to.be.true;\r\n    });\r\n  });\r\n  });\r\n```\r\n\r\n`src/components/CommentBox.js`\r\n```js\r\nimport React, {Component,Text, View, AsyncStorage } from 'react-native';\r\nimport CommentList from './CommentList.js';\r\nimport CommentForm from './CommentForm.js';\r\n\r\nexport default class CommentBox extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {data: []};\r\n    this.handleCommentSubmit = this.handleCommentSubmit.bind(this);\r\n    this.getComments = this.getComments.bind(this);\r\n  }\r\n\r\n  static propTypes = {\r\n    asyncStorageKey: React.PropTypes.string\r\n  };\r\n\r\n  getComments() {\r\n    AsyncStorage.getItem(this.props.asyncStorageKey)\r\n      .then((comments) => {\r\n        comments = JSON.parse(comments);\r\n        this.setState({ data: comments });\r\n      })\r\n    .catch(() => {\r\n    });\r\n  }\r\n\r\n  handleCommentSubmit(comment_data) {\r\n    var comments = this.state.data;\r\n    comments.push(comment_data);\r\n    AsyncStorage.setItem(this.props.asyncStorageKey, JSON.stringify(comments));\r\n    this.getComments();\r\n  }\r\n\r\n  render() {\r\n    return(\r\n      <view>\r\n        <text>Comment It</text>\r\n        <commentlist data=\"{this.state.data}/\">\r\n        <commentform oncommentsubmit=\"{this.handleCommentSubmit}/\">\r\n      </commentform></commentlist></view>\r\n  );\r\n  }\r\n}\r\n```\r\nTo get the app up and running we need to have a root component and register it in the App registry  \r\nLet us create a component called App and render CommentBox component inside it. While rendering the CommentBox component, we pass in the AsyncStorage key as props.\r\n\r\n`src/__specs__/app.spec.js`\r\n```js\r\nimport React from 'react-native';\r\nimport { shallow } from 'enzyme';\r\nimport { expect } from 'chai';\r\n\r\nimport CommentBox from '../components/CommentBox.js';\r\nimport App from '../app.js';\r\ndescribe('<app>', () => {\r\n  it('should render a commentBox component', () => {\r\n    const wrapper = shallow(<app>);\r\n\r\n    expect(wrapper.find(CommentBox)).to.have.length(1);\r\n  });\r\n\r\n  it('should pass data as props on rendering CommentBox component', () => {\r\n    const wrapper = shallow(<app>);\r\n\r\n    expect(wrapper.find(CommentBox).props().asyncStorageKey).to.eql('comments');\r\n  });\r\n});\r\n```\r\n\r\n`src/components/app.js`\r\n```js\r\nimport React, { Component } from 'react-native';\r\nimport CommentBox from './components/CommentBox.js';\r\n\r\nexport default class App extends Component {\r\n  render() {\r\n\r\n    return (\r\n        <commentbox asyncstoragekey=\"{'comments'}/\">\r\n    );\r\n  }\r\n}\r\n```\r\nNow register the component in the app registry and that's it.\r\n\r\n`index.android.js`\r\n```js\r\nimport { AppRegistry } from 'react-native';\r\nimport App from './src/app';\r\nAppRegistry.registerComponent('ReactNativeBoilerplate', () => App);\r\n```\r\nYou can view the entire codebase [here][20] .\r\n\r\n* * *\r\n\r\n**Finally**\r\n\r\nPhew! That was a long exercise. We're proud that you completed it and happy for your learnings. That was mostly about UI testing. We also have sample tests for asynchronous JS code, redux, authentication etc. in our boilerplate. Do check them out. \r\n\r\nTDD provides a tight feedback loop that cranks up our development workflow and improves quality and maintainability of code. TDD is one among many engineering practises that we follow here at Multunus. There are other practises that we follow, like [Continous Integration][21] and guess what. We've started integrating these concepts into our boilerplate too. Do checkout our blogpost about [Automated environment management in React Native – iOS][22].\r\n\r\n## Contributing\r\n\r\nSee the [CONTRIBUTING] document.\r\nThank you, [contributors]!\r\n\r\n  [CONTRIBUTING]: CONTRIBUTING.md\r\n  [contributors]: https://github.com/multunus/$(REPO_NAME)/graphs/contributors\r\n\r\n## License\r\n\r\nReact Native Boilerplate is Copyright (c) 2016 Multunus Software Pvt. Ltd.\r\nIt is free software, and may be redistributed\r\nunder the terms specified in the [LICENSE] file.\r\n\r\n  [LICENSE]: /LICENSE\r\n\r\n## About\r\n\r\n![multunus](https://s3.amazonaws.com/multunus-images/Multunus_Logo_Vector_resized.png)\r\n\r\nReact Native Boilerplate is maintained and funded by Multunus Software Pvt. Ltd.\r\nThe names and logos for Multunus are trademarks of Multunus Software Pvt. Ltd.\r\n\r\nWe love open source software!\r\nSee [our other projects][community]\r\nor [hire us][hire] to help build your product.\r\n\r\n  [community]: http://www.multunus.com/community?utm_source=github\r\n  [hire]: http://www.multunus.com/contact?utm_source=github\r\n\r\n\r\n[1]: https://babeljs.io/\r\n[2]: https://mochajs.org/\r\n[3]: https://nodejs.org/en/\r\n[4]: http://chaijs.com/\r\n[5]: http://sinonjs.org/\r\n[6]: https://github.com/lelandrichardson/react-native-mock\r\n[7]: http://airbnb.io/enzyme/\r\n[8]: https://github.com/multunus/react-native-boilerplate\r\n[9]: https://github.com/auth0/nodejs-jwt-authentication-sample\r\n[10]: https://facebook.github.io/react/\r\n[11]: https://facebook.github.io/react/docs/tutorial.html\r\n[12]: https://en.wikipedia.org/wiki/Test-driven_development\r\n[13]: https://facebook.github.io/react-native/docs/asyncstorage.html\r\n[14]: http://airbnb.io/enzyme/docs/api/shallow.html\r\n[15]: https://github.com/airbnb/enzyme\r\n[16]: http://www.jamesshore.com/Blog/Red-Green-Refactor.html\r\n[17]: https://facebook.github.io/react-native/docs/listview.html\r\n[18]: https://facebook.github.io/react/docs/reusable-components.html\r\n[19]: http://airbnb.io/enzyme/docs/api/ShallowWrapper/simulate.html\r\n[20]: https://github.com/multunus/React-Native-TDD-Tutorial\r\n[21]: https://www.thoughtworks.com/continuous-integration\r\n[22]: http://www.multunus.com/blog/2016/06/automated-environment-management-react-native-ios/\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}